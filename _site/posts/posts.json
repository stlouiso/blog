[
  {
    "path": "posts/2021-07-08-predicting-customer-tenurewith-mlb-hitters/",
    "title": "Predicting Customer Tenure...with MLB Hitters",
    "description": "How will long will a customer stay with our business or, in this case, how long will a MLB hitter stay in the MLB? In this post, I go through the value of knowing how long a customer will be with an organization, EDA of MLB data, how to clean and setup data for modeling, fitting a linear model and a gradient boosted tree model with xgBoost.",
    "author": [
      {
        "name": "Louis Oberdiear",
        "url": "thelob.blog/louisoberdiear"
      }
    ],
    "date": "2021-06-24",
    "categories": [
      "customer tenure",
      "customer lifetime value",
      "customer series",
      "data science",
      "rstats"
    ],
    "contents": "\r\n\r\nContents\r\nIntro: The Why\r\nCustomer Lifetime Value\r\n\r\nThe Data\r\nEDA\r\nModeling\r\nBuild A Simple Linear Baseline model\r\n\r\nExamine xgBoost Predictions\r\nNext Steps\r\n\r\nIntro: The Why\r\nI believe being able to know how long a customer will be with your business is inherently valuable, but why exactly?\r\nFirst scenario: Customer A\r\nLet’s pose a few scenarios. The first scenario is that we know Customer A will only be a customer with us for two years. In this scenario, customers stay with our business on average for ten years so two years is relatively short. Is it valuable to know that Customer A won’t be with us very long? What can we do about it?\r\nWell, in my mind, we have two different paths. The Abandonment path and the Retainment path. Knowing Customer A will only be with us for two years, we can simply cut our losses and not put anymore money into Customer A whether that be through advertisement or discounts and this would be the Abandonment path.\r\nOn the other hand, we could try and figure out different ways to extend their stay with us through different interventions and this would be the Retainment path. We could try a number of different interventions and measure their effectiveness and their return on investment.\r\nSecond Scenario: Customer B\r\nWhat about the other end of the spectrum where we know a customer will be with us for 15 years. This is Customer B. Is it valuable to know we have a potentially very loyal customer?\r\nAgain, I see two paths of treatment. The first path is the Stay the Course path where we treat them exactly how we would normally treat them. We know they will be with us a long time so why change anything?\r\nThe second path is the Up Sell Path where we give them more attention and try to get our hooks in deeper by offering more and more products to them. Maybe even give them special discounts and reward them for being a loyal customer and hopefully turning Customer B into a brand ambassador that will recommend our organization to their friends and family.\r\nI think looking at this two extreme scenarios show how knowing customer tenure is valuable, but I have another reason in mind. We are going to predict customer tenure in order to calculate Customer Lifetime Value.\r\nCustomer Lifetime Value\r\nThere are many ways to calculate Customer Lifetime Value and different formulas will calculate at different organization levels. For example, some formulas calculate overall Customer Lifetime Value. This will let you know the value of an average customer. Knowing the value of an average customer makes sense if an organization is trying to calculate the return on investment on different customer acquisition and retainment efforts.\r\nThat’s not my goal here, however. I want to know how valuable a customer is to the company on an individual basis. Some customers are more valuable than others and I want to be able to identify them. The main goal here is to be able to identify early on the potential lifetime value of a customer and then use the treatments mentioned above.\r\nI have seen some customer level CLV calculations simply use average yearly monetary value and multiply it by the average customer tenure. This works well as a rough estimate but I want to be more precise and having a more precise tenure estimate will lead to more precise CLV estimates.\r\nIn this example, our customers are going to be MLB hitters. We are going to be predicting how many years a hitter stays in the MLB. Then in the next blog post, we will use the predicted tenure to estimate the lifetime value for hitters.\r\nThe Data\r\nHere are the packages used for this post:\r\n\r\n\r\nShow code\r\n\r\nlibrary(lubridate)\r\nlibrary(tidylog)\r\nlibrary(broom)\r\nlibrary(DataExplorer)\r\nlibrary(tidymodels)\r\nlibrary(tidyverse)\r\nlibrary(skimr)\r\nlibrary(gt)\r\nlibrary(performance)\r\nlibrary(GGally)\r\n\r\n\r\n\r\nWe’ll again be using the R package Lahman. In the Lahman package, there is multiple datasets. Here is a description of the dataset contained in the Lahman package:\r\n\r\n\r\nShow code\r\n\r\nlibrary(Lahman)\r\nLahman::LahmanData %>% \r\n  as_tibble() %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#mvvmkjhaia .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#mvvmkjhaia .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#mvvmkjhaia .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#mvvmkjhaia .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#mvvmkjhaia .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#mvvmkjhaia .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#mvvmkjhaia .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#mvvmkjhaia .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#mvvmkjhaia .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#mvvmkjhaia .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#mvvmkjhaia .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#mvvmkjhaia .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#mvvmkjhaia .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#mvvmkjhaia .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#mvvmkjhaia .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#mvvmkjhaia .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#mvvmkjhaia .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#mvvmkjhaia .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#mvvmkjhaia .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#mvvmkjhaia .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#mvvmkjhaia .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#mvvmkjhaia .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#mvvmkjhaia .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#mvvmkjhaia .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#mvvmkjhaia .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#mvvmkjhaia .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#mvvmkjhaia .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#mvvmkjhaia .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#mvvmkjhaia .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#mvvmkjhaia .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#mvvmkjhaia .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#mvvmkjhaia .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#mvvmkjhaia .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#mvvmkjhaia .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#mvvmkjhaia .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nfile\r\n      class\r\n      nobs\r\n      nvar\r\n      title\r\n    AllstarFull\r\ndata.frame\r\n4993\r\n8\r\nAllstarFull tableAppearances\r\ndata.frame\r\n99466\r\n21\r\nAppearances tableAwardsManagers\r\ndata.frame\r\n171\r\n6\r\nAwardsManagers tableAwardsPlayers\r\ndata.frame\r\n6026\r\n6\r\nAwardsPlayers tableAwardsShareManagers\r\ndata.frame\r\n401\r\n7\r\nAwardsShareManagers tableAwardsSharePlayers\r\ndata.frame\r\n6705\r\n7\r\nAwardsSharePlayers tableBatting\r\ndata.frame\r\n99846\r\n22\r\nBatting tableBattingPost\r\ndata.frame\r\n11294\r\n22\r\nBattingPost tableCollegePlaying\r\ndata.frame\r\n17350\r\n3\r\nCollegePlaying tableFielding\r\ndata.frame\r\n167938\r\n18\r\nFielding tableFieldingOF\r\ndata.frame\r\n12028\r\n6\r\nFieldingOF tableFieldingPost\r\ndata.frame\r\n11924\r\n17\r\nFieldingPost dataHallOfFame\r\ndata.frame\r\n4088\r\n9\r\nHall of Fame Voting DataManagers\r\ndata.frame\r\n3370\r\n10\r\nManagers tableManagersHalf\r\ndata.frame\r\n93\r\n10\r\nManagersHalf tableMaster\r\ndata.frame\r\n18589\r\n26\r\nMaster tablePitching\r\ndata.frame\r\n43330\r\n30\r\nPitching tablePitchingPost\r\ndata.frame\r\n4945\r\n30\r\nPitchingPost tableSalaries\r\ndata.frame\r\n24758\r\n5\r\nSalaries tableSchools\r\ndata.frame\r\n1207\r\n5\r\nSchools tableSeriesPost\r\ndata.frame\r\n298\r\n9\r\nSeriesPost tableTeams\r\ndata.frame\r\n2775\r\n48\r\nTeams tableTeamsFranchises\r\ndata.frame\r\n120\r\n4\r\nTeamFranchises tableTeamsHalf\r\ndata.frame\r\n52\r\n10\r\nTeamsHalf table\r\n\r\nThe People dataset looks like a good place to start.\r\n\r\n\r\nShow code\r\n\r\ndata(People)\r\nglimpse(People) \r\n\r\n\r\nRows: 20,093\r\nColumns: 26\r\n$ playerID     <chr> \"aardsda01\", \"aaronha01\", \"aaronto01\", \"aasedo0~\r\n$ birthYear    <int> 1981, 1934, 1939, 1954, 1972, 1985, 1850, 1877,~\r\n$ birthMonth   <int> 12, 2, 8, 9, 8, 12, 11, 4, 11, 10, 3, 10, 2, 8,~\r\n$ birthDay     <int> 27, 5, 5, 8, 25, 17, 4, 15, 11, 14, 16, 22, 16,~\r\n$ birthCountry <chr> \"USA\", \"USA\", \"USA\", \"USA\", \"USA\", \"D.R.\", \"USA~\r\n$ birthState   <chr> \"CO\", \"AL\", \"AL\", \"CA\", \"FL\", \"La Romana\", \"PA\"~\r\n$ birthCity    <chr> \"Denver\", \"Mobile\", \"Mobile\", \"Orange\", \"Palm B~\r\n$ deathYear    <int> NA, 2021, 1984, NA, NA, NA, 1905, 1957, 1962, 1~\r\n$ deathMonth   <int> NA, 1, 8, NA, NA, NA, 5, 1, 6, 4, 2, 6, NA, NA,~\r\n$ deathDay     <int> NA, 22, 16, NA, NA, NA, 17, 6, 11, 27, 13, 11, ~\r\n$ deathCountry <chr> NA, \"USA\", \"USA\", NA, NA, NA, \"USA\", \"USA\", \"US~\r\n$ deathState   <chr> NA, \"GA\", \"GA\", NA, NA, NA, \"NJ\", \"FL\", \"VT\", \"~\r\n$ deathCity    <chr> NA, \"Atlanta\", \"Atlanta\", NA, NA, NA, \"Pemberto~\r\n$ nameFirst    <chr> \"David\", \"Hank\", \"Tommie\", \"Don\", \"Andy\", \"Fern~\r\n$ nameLast     <chr> \"Aardsma\", \"Aaron\", \"Aaron\", \"Aase\", \"Abad\", \"A~\r\n$ nameGiven    <chr> \"David Allan\", \"Henry Louis\", \"Tommie Lee\", \"Do~\r\n$ weight       <int> 215, 180, 190, 190, 184, 235, 192, 170, 175, 16~\r\n$ height       <int> 75, 72, 75, 75, 73, 74, 72, 71, 71, 68, 71, 70,~\r\n$ bats         <fct> R, R, R, R, L, L, R, R, R, L, R, R, R, R, L, R,~\r\n$ throws       <fct> R, R, R, R, L, L, R, R, R, L, R, R, R, L, L, R,~\r\n$ debut        <chr> \"2004-04-06\", \"1954-04-13\", \"1962-04-10\", \"1977~\r\n$ finalGame    <chr> \"2015-08-23\", \"1976-10-03\", \"1971-09-26\", \"1990~\r\n$ retroID      <chr> \"aardd001\", \"aaroh101\", \"aarot101\", \"aased001\",~\r\n$ bbrefID      <chr> \"aardsda01\", \"aaronha01\", \"aaronto01\", \"aasedo0~\r\n$ deathDate    <date> NA, 2021-01-22, 1984-08-16, NA, NA, NA, 1905-0~\r\n$ birthDate    <date> 1981-12-27, 1934-02-05, 1939-08-05, 1954-09-08~\r\n\r\nWe can use their debut, finalGame, and birthDate. This will give us the ability to calculate year number in league (e.g. 1st year in league, 2nd, etc.), their age, and their final tenure.\r\nWe are going to be predicting hitters so we will definitely use the Batting dataset.\r\n\r\n\r\nShow code\r\n\r\ndata(Batting)\r\nglimpse(Batting)\r\n\r\n\r\nRows: 108,789\r\nColumns: 22\r\n$ playerID <chr> \"abercda01\", \"addybo01\", \"allisar01\", \"allisdo01\", ~\r\n$ yearID   <int> 1871, 1871, 1871, 1871, 1871, 1871, 1871, 1871, 187~\r\n$ stint    <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ~\r\n$ teamID   <fct> TRO, RC1, CL1, WS3, RC1, FW1, RC1, BS1, FW1, BS1, C~\r\n$ lgID     <fct> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ G        <int> 1, 25, 29, 27, 25, 12, 1, 31, 1, 18, 22, 1, 10, 3, ~\r\n$ AB       <int> 4, 118, 137, 133, 120, 49, 4, 157, 5, 86, 89, 3, 36~\r\n$ R        <int> 0, 30, 28, 28, 29, 9, 0, 66, 1, 13, 18, 0, 6, 7, 24~\r\n$ H        <int> 0, 32, 40, 44, 39, 11, 1, 63, 1, 13, 27, 0, 7, 6, 3~\r\n$ X2B      <int> 0, 6, 4, 10, 11, 2, 0, 10, 1, 2, 1, 0, 0, 0, 9, 3, ~\r\n$ X3B      <int> 0, 0, 5, 2, 3, 1, 0, 9, 0, 1, 10, 0, 0, 0, 1, 3, 0,~\r\n$ HR       <int> 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 1, 0, 0, ~\r\n$ RBI      <int> 0, 13, 19, 27, 16, 5, 2, 34, 1, 11, 18, 0, 1, 5, 21~\r\n$ SB       <int> 0, 8, 3, 1, 6, 0, 0, 11, 0, 1, 0, 0, 2, 2, 4, 4, 0,~\r\n$ CS       <int> 0, 1, 1, 1, 2, 1, 0, 6, 0, 0, 1, 0, 0, 0, 0, 4, 0, ~\r\n$ BB       <int> 0, 4, 2, 0, 2, 0, 1, 13, 0, 0, 3, 1, 2, 0, 2, 9, 0,~\r\n$ SO       <int> 0, 0, 5, 2, 1, 1, 0, 1, 0, 0, 4, 0, 0, 0, 2, 2, 3, ~\r\n$ IBB      <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ HBP      <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ SH       <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ SF       <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ GIDP     <int> 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 2, 0, 1, 2, 0, ~\r\n\r\nNow let’s combine the People and the Batting datasets.\r\n\r\n\r\nShow code\r\n\r\npitchers <- Lahman::Pitching %>%\r\n  select(playerID) %>%\r\n  distinct()\r\n\r\nold_players <- People %>%\r\n  filter(ymd(debut) < '1961-01-01')\r\n\r\npeople_tenure <- People %>%\r\n  select(playerID, nameFirst, nameLast, birthDate, debut, finalGame) %>%\r\n  filter(!is.na(finalGame)) %>%\r\n  filter(ymd(finalGame) < '2018-01-01') %>%\r\n  anti_join(old_players) %>%\r\n  inner_join(Batting) %>%\r\n  group_by(playerID, yearID) %>%\r\n  summarise(nameFirst = first(nameFirst),\r\n            nameLast = first(nameLast),\r\n            birthDate = first(birthDate),\r\n            debut = first(debut),\r\n            finalGame = first(finalGame),\r\n            stint = first(stint),\r\n            teamID = first(teamID),\r\n            lgID = first(lgID),\r\n            G = sum(G),\r\n            AB = sum(AB),\r\n            R = sum(R),\r\n            H = sum(H),\r\n            X2B = sum(X2B),\r\n            X3B = sum(X3B),\r\n            HR = sum(HR),\r\n            RBI = sum(RBI),\r\n            SB = sum(SB),\r\n            CS = sum(CS),\r\n            BB = sum(BB),\r\n            SO = sum(SO),\r\n            IBB = sum(IBB),\r\n            HBP = sum(HBP),\r\n            SH = sum(SH),\r\n            SF = sum(SF),\r\n            GIDP = sum(GIDP),\r\n            .groups = \"drop\") %>%\r\n  anti_join(pitchers) %>%\r\n  filter(lgID %in% c('NL', 'AL')) %>%\r\n  Lahman::battingStats(data = .) %>%\r\n  group_by(playerID, stint) %>%\r\n  mutate(year_num = row_number()) %>%\r\n  ungroup() %>%\r\n  group_by(playerID) %>%\r\n  mutate(tenure = n()) %>%\r\n  ungroup() %>%\r\n  mutate(age = as.double((ymd(paste0(yearID, '-01-01')) - ymd(birthDate))/365)) %>%\r\n  drop_na() %>%\r\n  mutate(decade = yearID - (yearID %% 10)) %>%\r\n  mutate(TBB = BB + IBB + HBP,         # combine all walk types\r\n         TAB = AB + TBB + SH + SF) %>% # create total at-bats\r\n  select(-c(BB, IBB, HBP, SH, SF))     # remove unneeded columns\r\n\r\n\r\n\r\nLet me walk through the code above and explain what is happening and my thought process.\r\nFirst, we need to identify the pitchers in our Batting dataset and get rid of them.\r\npitchers <- Lahman::Pitching %>%\r\n  select(playerID) %>%\r\n  distinct()\r\nNext, I want to remove players from older eras.\r\nold_players <- People %>%\r\n  filter(ymd(debut) < '1961-01-01')\r\nHere is a good quote from The Sport Journal on MLB Eras explaining the ERAs:\r\n\r\nA common list presented at Baseball-Reference described the eras as the Dead Ball Era (1901-1919), the Live Ball Era (1920-1941), the Integration Era (1942-1960), the Expansion Era (1961-1976), the Free Agency Era (1977-1993) and the Long Ball/Steroid Era (1994-2005) (17). This study runs through the 2011 season and aseventh era will be added and labeled the Post Steroid Era (2006-2011).\r\n\r\nI removed anyone who debuted before the Expansion Era (1961). Average tenure might change depending on the decade so this is something we should investigate in the EDA stage.\r\nI then removed anyone who doesn’t have a final game and also if their final game is after 2018. I want players that are not currently playing and have finished their MLB career. This doesn’t guarantee this but it comes close enough.\r\nfilter(!is.na(finalGame)) %>%\r\n  filter(ymd(finalGame) < '2018-01-01')\r\nThe next step is to make sure all players only have one entry per year. Some players have two (or more) for a year because they were traded or waived then picked up by another team. I don’t really care about this so I am going to aggregate their stats to the year level.\r\ngroup_by(playerID, yearID) %>%\r\n  summarise(nameFirst = first(nameFirst),\r\n            nameLast = first(nameLast),\r\n            birthDate = first(birthDate),\r\n            debut = first(debut),\r\n            finalGame = first(finalGame),\r\n            stint = first(stint),\r\n            teamID = first(teamID),\r\n            lgID = first(lgID),\r\n            G = sum(G),\r\n            AB = sum(AB),\r\n            R = sum(R),\r\n            H = sum(H),\r\n            X2B = sum(X2B),\r\n            X3B = sum(X3B),\r\n            HR = sum(HR),\r\n            RBI = sum(RBI),\r\n            SB = sum(SB),\r\n            CS = sum(CS),\r\n            BB = sum(BB),\r\n            SO = sum(SO),\r\n            IBB = sum(IBB),\r\n            HBP = sum(HBP),\r\n            SH = sum(SH),\r\n            SF = sum(SF),\r\n            GIDP = sum(GIDP),\r\n            .groups = \"drop\")\r\nThe next steps:\r\n1. Only include players from the NL and AL\r\nfilter(lgID %in% c('NL', 'AL'))\r\nUse the function battingStats to calculate rate statistics like Batting Average, On-base Percentage, Slugging and OPS.\r\nLahman::battingStats(data = .)\r\nCalculate the year number in league for each player\r\ngroup_by(playerID, stint) %>%\r\n  mutate(year_num = row_number())\r\nCalculate total tenure for each player\r\ngroup_by(playerID) %>%\r\n  mutate(tenure = n())\r\nCalculate player age for each given year\r\nmutate(age = as.double((ymd(paste0(yearID, '-01-01')) - ymd(birthDate))/365))\r\nCalculate decade\r\nmutate(decade = yearID %% 10)\r\nFinally, calculate total walks and total plate appearances\r\nmutate(TBB = BB + IBB + HBP,     # combine all walk types\r\n       TAB = AB + TBB + SH + SF) # create total at-bats\r\nAll of this together gives us data for batters only that debuted after 1961. It gives us data for each year a batter was in the league. Let’s take a look at my favorite player of all time and the greatest shortstop to play baseball to illustrate the structure (Ozzie Smith). Having each row be a year a player played in the league gives us the opportunity to teach a model how a person looks as a rookie that ultimately played in the league for 19 years. Ozzie debuted at age 23, got a ton of at-bats (668) and posted what is likely a below average OPS.\r\n\r\n\r\nShow code\r\n\r\npeople_tenure %>%\r\n  filter(playerID == 'smithoz01') %>%\r\n  select(nameFirst, nameLast, yearID, year_num, age, TAB, OPS, tenure) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#kafolxablm .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#kafolxablm .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#kafolxablm .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#kafolxablm .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#kafolxablm .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#kafolxablm .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#kafolxablm .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#kafolxablm .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#kafolxablm .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#kafolxablm .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#kafolxablm .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#kafolxablm .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#kafolxablm .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#kafolxablm .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#kafolxablm .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#kafolxablm .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#kafolxablm .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#kafolxablm .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#kafolxablm .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#kafolxablm .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#kafolxablm .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#kafolxablm .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#kafolxablm .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#kafolxablm .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#kafolxablm .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#kafolxablm .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#kafolxablm .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#kafolxablm .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#kafolxablm .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#kafolxablm .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#kafolxablm .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#kafolxablm .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#kafolxablm .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#kafolxablm .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#kafolxablm .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nnameFirst\r\n      nameLast\r\n      yearID\r\n      year_num\r\n      age\r\n      TAB\r\n      OPS\r\n      tenure\r\n    Ozzie\r\nSmith\r\n1978\r\n1\r\n23.03288\r\n668\r\n0.623\r\n19Ozzie\r\nSmith\r\n1979\r\n2\r\n24.03288\r\n654\r\n0.522\r\n19Ozzie\r\nSmith\r\n1980\r\n3\r\n25.03288\r\n713\r\n0.589\r\n19Ozzie\r\nSmith\r\n1981\r\n4\r\n26.03562\r\n508\r\n0.550\r\n19Ozzie\r\nSmith\r\n1982\r\n5\r\n27.03562\r\n579\r\n0.653\r\n19Ozzie\r\nSmith\r\n1983\r\n6\r\n28.03562\r\n635\r\n0.656\r\n19Ozzie\r\nSmith\r\n1984\r\n7\r\n29.03562\r\n489\r\n0.684\r\n19Ozzie\r\nSmith\r\n1985\r\n8\r\n30.03836\r\n626\r\n0.716\r\n19Ozzie\r\nSmith\r\n1986\r\n9\r\n31.03836\r\n622\r\n0.709\r\n19Ozzie\r\nSmith\r\n1987\r\n10\r\n32.03836\r\n709\r\n0.775\r\n19Ozzie\r\nSmith\r\n1988\r\n11\r\n33.03836\r\n671\r\n0.686\r\n19Ozzie\r\nSmith\r\n1989\r\n12\r\n34.04110\r\n667\r\n0.696\r\n19Ozzie\r\nSmith\r\n1990\r\n13\r\n35.04110\r\n596\r\n0.635\r\n19Ozzie\r\nSmith\r\n1991\r\n14\r\n36.04110\r\n643\r\n0.747\r\n19Ozzie\r\nSmith\r\n1992\r\n15\r\n37.04110\r\n594\r\n0.709\r\n19Ozzie\r\nSmith\r\n1993\r\n16\r\n38.04384\r\n604\r\n0.693\r\n19Ozzie\r\nSmith\r\n1994\r\n17\r\n39.04384\r\n436\r\n0.675\r\n19Ozzie\r\nSmith\r\n1995\r\n18\r\n40.04384\r\n182\r\n0.526\r\n19Ozzie\r\nSmith\r\n1996\r\n19\r\n41.04384\r\n261\r\n0.728\r\n19\r\n\r\nEDA\r\nAlways look at the distributions of your variables.\r\n\r\n\r\nShow code\r\n\r\nDataExplorer::plot_histogram(people_tenure)\r\n\r\n\r\n\r\n\r\nNothing jumps out to me. We definitely have some outliers, but we will check to see the effect after modeling.\r\nNext, let’s check out how the variables interact with each other. A good way to investigate this is through a correlation matrix. If modeling with a linear model then you need to be concerned with how correlated the variables are with each other.\r\nThe corrplot package has a great way to visualize this and on top of that will cluster your variables together using different cluster techniques. Here I chose a hierarchical clustering method with 5 clusters.\r\n\r\n\r\nShow code\r\n\r\nlibrary(corrplot)\r\n\r\ncor_matrix <- people_tenure %>%\r\n  select(-c(playerID, yearID, nameFirst, nameLast, birthDate, \r\n             debut, finalGame, stint, teamID, lgID)) %>%\r\n  select(c(year_num, tenure, age, G, TAB, TBB, TB, SO, H, X2B, X3B, HR,\r\n           BA, SlugPct, OBP, OPS, BABIP)) %>%\r\n  cor()\r\n\r\ncorrplot(cor_matrix, order = \"hclust\", addrect = 5)\r\n\r\n\r\n\r\n\r\nWhat’s really cool about this is how we can see we have five different types of variables. Left corner we have the ‘Time’ stats: year_num & age. We then have the ‘Rate’ stats: BA, OBP, SlugPct, and OPS. Triples get grouped on their own because they happen so infrequently. Our target variable is by itself also, then we have the ‘Counting’ stats in the bottom right: Singles, Doubles, HRs, SOs, Walks, At Bats, & Games. Pretty neat to see them group like that.\r\nLet’s see how the variables specifically correlate with our target variable Tenure.\r\n\r\n\r\nShow code\r\n\r\nlibrary(corrr)\r\n\r\npeople_tenure %>%\r\n  select(-c(playerID, yearID, nameFirst, nameLast, birthDate, \r\n             debut, finalGame, stint, teamID, lgID)) %>%\r\n  select(c(year_num, tenure, age, G, TAB, TBB, TB, SO, H, X2B, X3B, HR,\r\n           SlugPct, OBP, OPS, BABIP)) %>%\r\n  correlate() %>%\r\n  stretch() %>%\r\n  filter(x == \"tenure\") %>%\r\n  arrange(desc(r)) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#duhifavpwb .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#duhifavpwb .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#duhifavpwb .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#duhifavpwb .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#duhifavpwb .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#duhifavpwb .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#duhifavpwb .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#duhifavpwb .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#duhifavpwb .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#duhifavpwb .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#duhifavpwb .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#duhifavpwb .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#duhifavpwb .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#duhifavpwb .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#duhifavpwb .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#duhifavpwb .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#duhifavpwb .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#duhifavpwb .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#duhifavpwb .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#duhifavpwb .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#duhifavpwb .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#duhifavpwb .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#duhifavpwb .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#duhifavpwb .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#duhifavpwb .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#duhifavpwb .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#duhifavpwb .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#duhifavpwb .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#duhifavpwb .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#duhifavpwb .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#duhifavpwb .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#duhifavpwb .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#duhifavpwb .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#duhifavpwb .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#duhifavpwb .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nx\r\n      y\r\n      r\r\n    tenure\r\nyear_num\r\n0.6174973tenure\r\nTAB\r\n0.5603746tenure\r\nTB\r\n0.5591402tenure\r\nH\r\n0.5585071tenure\r\nG\r\n0.5406922tenure\r\nTBB\r\n0.5334992tenure\r\nX2B\r\n0.5233772tenure\r\nHR\r\n0.4550314tenure\r\nSO\r\n0.4323623tenure\r\nage\r\n0.3500512tenure\r\nX3B\r\n0.3350727tenure\r\nOPS\r\n0.3186440tenure\r\nSlugPct\r\n0.3057516tenure\r\nOBP\r\n0.2930648tenure\r\nBABIP\r\n0.1349052tenure\r\ntenure\r\nNA\r\n\r\nInteresting. We can use these correlations in helping us determine which variables to include in the models.\r\nLet’s take a look at how decade relates to tenure to wrap up the EDA section.\r\n\r\n\r\nShow code\r\n\r\npeople_tenure %>%\r\n  group_by(decade) %>%\r\n  summarise(avg_tenure = mean(tenure)) %>%\r\n  ggplot(aes(x = as_factor(decade), y = avg_tenure, fill = as_factor(decade))) +\r\n  geom_col(stat = \"identity\") +\r\n  theme(legend.position = \"none\")\r\n\r\n\r\n\r\n\r\nThere are slight differences in tenure at the tail ends.\r\nModeling\r\nI have a rough outline when I model:\r\nBuild simple linear baseline model\r\nBuild simple blackbox model\r\nAnalyze residuals from blackbox model\r\nFeature engineer to try and correct large residuals\r\nTune hyper-paramenters for blackbox model\r\nBuild A Simple Linear Baseline model\r\nThe reason to build a simple linear baseline model is to have an idea of how much a model has improved with the use of new models, hyper-parameter tuning, and future feature engineering. It also gives you an idea of how the variables interact with the target and the size of the effect.\r\nI recommend making the first model by using the features you think are the most important. Include the bare minimum number of features.\r\nIn this case of trying to predict MLB tenure, I think year_num, age, TAB (total at-bats), and OPS (on-base percentage + slugging percentage). I think year_num is going to be important because the longer you have been in the league then the longer your tenure will be. Age will be important because the younger you are then the longer you can be in the league. Total at-bats represent opportunity. If a player is getting opportunity then it either means the manager believes in the player or they are performing well. OPS represents performance. OPS is the sum of on-base percentage and slugging percentage. On-base is the rate of getting on base without consideration of how many bases the hit resulted in. Slugging percentage is the total bases on the hits divided by the at-bats. Slugging percentage is higher the more bases a batter gets. Home run hitters will have a higher slugging than single hitters. OPS is nice because it accounts for how often a batter gets on base and the total bases all in one metric.\r\nThe fist model will be based on theory but I am also going to build a few other models using the variables that have the highest correlations to tenure.\r\nHere’s the formula for the theory model: tenure ~ year_num + age + TAB + OPS\r\nSince we have isolated the target and the features we are most interested, we can visualize the relationship between all of the variables using a pair plot. There is a great package GGally that has a function ggpairs that products pair plots and is a great way to explore relationships and distributions.\r\n\r\n\r\nShow code\r\n\r\npeople_tenure %>%\r\n  select(tenure, age, year_num, TAB, OPS) %>%\r\n  ggpairs()\r\n\r\n\r\n\r\n\r\nLet’s fit the models and compare their performances.\r\n\r\n\r\nShow code\r\n\r\nlm_theory <- lm(formula = tenure ~ year_num + age + TAB + OPS\r\n          , data = people_tenure)\r\n\r\nlm_corr1 <- lm(formula = tenure ~ year_num + TAB + OPS\r\n          , data = people_tenure)\r\n\r\nlm_corr2 <- lm(formula = tenure ~ year_num + TAB + OPS + TB + H + G\r\n            , data = people_tenure)\r\n\r\nlm_corr3 <- lm(formula = tenure ~ year_num + TAB + OPS + TB + H + G + TBB + X2B + HR + SO\r\n            , data = people_tenure)\r\nlm_corr4 <- lm(formula = tenure ~ year_num + age + TAB + OPS + TB + H + G + TBB + X2B + HR + SO + age + X3B + BABIP\r\n            , data = people_tenure)\r\n\r\nperformance::compare_performance(lm_theory, lm_corr1, lm_corr2, lm_corr3, lm_corr4) %>%\r\n  as_tibble() %>%\r\n  select(Name, Model, R2, RMSE) %>%\r\n  arrange(desc(R2)) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#fwcdmqponb .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#fwcdmqponb .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fwcdmqponb .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#fwcdmqponb .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#fwcdmqponb .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#fwcdmqponb .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fwcdmqponb .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#fwcdmqponb .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#fwcdmqponb .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#fwcdmqponb .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#fwcdmqponb .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#fwcdmqponb .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#fwcdmqponb .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#fwcdmqponb .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#fwcdmqponb .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#fwcdmqponb .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#fwcdmqponb .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#fwcdmqponb .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#fwcdmqponb .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#fwcdmqponb .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#fwcdmqponb .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#fwcdmqponb .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#fwcdmqponb .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#fwcdmqponb .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fwcdmqponb .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#fwcdmqponb .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fwcdmqponb .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#fwcdmqponb .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#fwcdmqponb .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#fwcdmqponb .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#fwcdmqponb .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#fwcdmqponb .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#fwcdmqponb .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#fwcdmqponb .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#fwcdmqponb .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nName\r\n      Model\r\n      R2\r\n      RMSE\r\n    lm_corr4\r\nlm\r\n0.6110783\r\n3.248215lm_theory\r\nlm\r\n0.6017334\r\n3.287007lm_corr3\r\nlm\r\n0.5387190\r\n3.537501lm_corr2\r\nlm\r\n0.5296241\r\n3.572204lm_corr1\r\nlm\r\n0.5251697\r\n3.589078\r\n\r\nNice, this is good to see. The theory model came in second and was only marginally behind the model that used every variable. An R^2 of .60 is also pretty good for only using 4 variables.\r\nLet’s look the coefficients to see which ones have the greatest impact on tenure.\r\n\r\n\r\nShow code\r\n\r\ntidy(lm_theory) %>%\r\n  mutate(estimate = round(estimate, digits = 3),\r\n         std.error = round(std.error, digits = 3),\r\n         statistic = round(statistic, digits = 3),\r\n         p.value = round(p.value, digits = 3)) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#twfzvaadjm .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#twfzvaadjm .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#twfzvaadjm .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#twfzvaadjm .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#twfzvaadjm .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#twfzvaadjm .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#twfzvaadjm .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#twfzvaadjm .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#twfzvaadjm .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#twfzvaadjm .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#twfzvaadjm .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#twfzvaadjm .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#twfzvaadjm .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#twfzvaadjm .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#twfzvaadjm .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#twfzvaadjm .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#twfzvaadjm .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#twfzvaadjm .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#twfzvaadjm .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#twfzvaadjm .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#twfzvaadjm .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#twfzvaadjm .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#twfzvaadjm .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#twfzvaadjm .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#twfzvaadjm .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#twfzvaadjm .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#twfzvaadjm .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#twfzvaadjm .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#twfzvaadjm .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#twfzvaadjm .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#twfzvaadjm .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#twfzvaadjm .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#twfzvaadjm .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#twfzvaadjm .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#twfzvaadjm .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nterm\r\n      estimate\r\n      std.error\r\n      statistic\r\n      p.value\r\n    (Intercept)\r\n19.966\r\n0.250\r\n79.895\r\n0year_num\r\n1.221\r\n0.011\r\n115.778\r\n0age\r\n-0.706\r\n0.010\r\n-68.910\r\n0TAB\r\n0.007\r\n0.000\r\n60.932\r\n0OPS\r\n1.896\r\n0.109\r\n17.441\r\n0\r\n\r\nAll of the features are significant predictors of tenure with year_num being by far the most important. Every 1 year increase in year_num results in 1.22 more years of tenure. For every increase in age by 1 year, tenure is reduced by .7 years. The theory of how long a player has been in the league, their age, their opportunity and their performance determining tenure seems to be a good theory.\r\nLet’s check the model for the appropriate assumptions.\r\n\r\n\r\nShow code\r\n\r\ncheck_model(lm_theory, panel = TRUE)\r\n\r\n\r\n\r\n\r\nBuild a Simple Blackbox Model\r\nNow is the time to build the simple blackbox model. In this case we are going to use the gradient boosted algorithm, xgBoost. I call it simple because the first go around we will be using the default hyper-parameters. There is a great package called tidymodels that will allow us to create workflows and the ability to quickly swap different machine learning algorithms. To learn more, here is a great resource: Tidy Models bookdown TMRW\r\nFirst, split the data into train and test datasets.\r\n\r\n\r\nShow code\r\n\r\nset.seed(123)\r\npt_split <- initial_split(people_tenure, prop = 3/4)\r\npt_train <- training(pt_split)\r\npt_test <- testing(pt_split)\r\n\r\n\r\n\r\nWe define the two formulas that we are going to be using and fit the models. We then collect the metrics and put them together for easy comparison.\r\n\r\n\r\nShow code\r\n\r\ntheory_formula <- formula(tenure ~ year_num + age + TAB + OPS)\r\nall_metrics_formula <- formula(tenure ~ year_num + age + TAB + OPS + TB + H + G + TBB + X2B + HR + SO + age + X3B + BABIP)\r\n\r\nlm_theory <- linear_reg() %>%\r\n  fit(theory_formula, data = pt_train)\r\n\r\nlm_all <- linear_reg() %>%\r\n  fit(theory_formula, data = pt_train)\r\n\r\nxgb_theory <- boost_tree(mode = \"regression\") %>%\r\n  set_engine(\"xgboost\") %>%\r\n  fit(theory_formula, data = pt_train)\r\n\r\nxgb_all <- boost_tree(mode = \"regression\") %>%\r\n  set_engine(\"xgboost\") %>%\r\n  fit(all_metrics_formula, data = pt_train)\r\n\r\nlm_theory_metrics <- lm_theory %>%\r\n  predict(pt_test) %>%\r\n  bind_cols(pt_test) %>%\r\n  metrics(truth = tenure, estimate = .pred) %>%\r\n  mutate(model = \"lm_theory\") %>%\r\n  select(model, .metric, .estimate) %>%\r\n  pivot_wider(names_from = .metric, values_from = .estimate)\r\n\r\nlm_all_metrics <- lm_all %>%\r\n  predict(pt_test) %>%\r\n  bind_cols(pt_test) %>%\r\n  metrics(truth = tenure, estimate = .pred) %>%\r\n  mutate(model = \"lm_all\") %>%\r\n  select(model, .metric, .estimate) %>%\r\n  pivot_wider(names_from = .metric, values_from = .estimate)\r\n\r\nxgb_theory_metrics <- xgb_theory %>%\r\n  predict(pt_test) %>%\r\n  bind_cols(pt_test) %>%\r\n  metrics(truth = tenure, estimate = .pred) %>%\r\n  mutate(model = \"xgb_theory\") %>%\r\n  select(model, .metric, .estimate) %>%\r\n  pivot_wider(names_from = .metric, values_from = .estimate)\r\n\r\nxgb_all_metrics <- xgb_all %>%\r\n  predict(pt_test) %>%\r\n  bind_cols(pt_test) %>%\r\n  metrics(truth = tenure, estimate = .pred) %>%\r\n  mutate(model = \"xgb_all\") %>%\r\n  select(model, .metric, .estimate) %>%\r\n  pivot_wider(names_from = .metric, values_from = .estimate)\r\n\r\nlm_theory_metrics %>%\r\n  bind_rows(lm_all_metrics, xgb_theory_metrics, xgb_all_metrics) %>%\r\n  arrange(rmse) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#vvfmpnvifp .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#vvfmpnvifp .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#vvfmpnvifp .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#vvfmpnvifp .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#vvfmpnvifp .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#vvfmpnvifp .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#vvfmpnvifp .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#vvfmpnvifp .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#vvfmpnvifp .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#vvfmpnvifp .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#vvfmpnvifp .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#vvfmpnvifp .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#vvfmpnvifp .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#vvfmpnvifp .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#vvfmpnvifp .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#vvfmpnvifp .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#vvfmpnvifp .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#vvfmpnvifp .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#vvfmpnvifp .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#vvfmpnvifp .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#vvfmpnvifp .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#vvfmpnvifp .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#vvfmpnvifp .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#vvfmpnvifp .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#vvfmpnvifp .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#vvfmpnvifp .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#vvfmpnvifp .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#vvfmpnvifp .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#vvfmpnvifp .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#vvfmpnvifp .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#vvfmpnvifp .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#vvfmpnvifp .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#vvfmpnvifp .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#vvfmpnvifp .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#vvfmpnvifp .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nmodel\r\n      rmse\r\n      rsq\r\n      mae\r\n    xgb_all\r\n3.204862\r\n0.6282084\r\n2.434345xgb_theory\r\n3.218378\r\n0.6249189\r\n2.449568lm_theory\r\n3.315353\r\n0.6019646\r\n2.581725lm_all\r\n3.315353\r\n0.6019646\r\n2.581725\r\n\r\nThe xgBoost model using the theory formula and default hyper-parameters outperformed the linear model by not much. We know the most important variables in the linear model was year_num, age, TAB, and OPS in the order. Let’s see what variables were the most important to the xgBoost theory model.\r\n\r\n\r\nShow code\r\n\r\nlibrary(vip)\r\n\r\nxgb_theory %>%\r\n  vip(geom = \"col\")\r\n\r\n\r\n\r\n\r\nAge becomes less important in the xgBoost model and total at-bats becomes more important.\r\nExamine xgBoost Predictions\r\nWe know how the model performed on the test data. On average the xgBoost model was off +/- 2.44 years. Let’s see how it predicted Ozzie Smith.\r\n\r\n\r\nShow code\r\n\r\nxgb_theory %>% \r\n  predict(people_tenure) %>%\r\n  bind_cols(people_tenure) %>%\r\n  filter(playerID == 'smithoz01') %>%\r\n  select(nameFirst, nameLast, yearID, year_num, age, TAB, OPS, tenure, .pred) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#lropuzcvtc .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#lropuzcvtc .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#lropuzcvtc .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#lropuzcvtc .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#lropuzcvtc .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#lropuzcvtc .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#lropuzcvtc .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#lropuzcvtc .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#lropuzcvtc .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#lropuzcvtc .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#lropuzcvtc .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#lropuzcvtc .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#lropuzcvtc .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#lropuzcvtc .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#lropuzcvtc .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#lropuzcvtc .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#lropuzcvtc .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#lropuzcvtc .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#lropuzcvtc .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#lropuzcvtc .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#lropuzcvtc .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#lropuzcvtc .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#lropuzcvtc .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#lropuzcvtc .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#lropuzcvtc .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#lropuzcvtc .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#lropuzcvtc .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#lropuzcvtc .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#lropuzcvtc .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#lropuzcvtc .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#lropuzcvtc .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#lropuzcvtc .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#lropuzcvtc .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#lropuzcvtc .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#lropuzcvtc .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nnameFirst\r\n      nameLast\r\n      yearID\r\n      year_num\r\n      age\r\n      TAB\r\n      OPS\r\n      tenure\r\n      .pred\r\n    Ozzie\r\nSmith\r\n1978\r\n1\r\n23.03288\r\n668\r\n0.623\r\n19\r\n11.06559Ozzie\r\nSmith\r\n1979\r\n2\r\n24.03288\r\n654\r\n0.522\r\n19\r\n10.88405Ozzie\r\nSmith\r\n1980\r\n3\r\n25.03288\r\n713\r\n0.589\r\n19\r\n11.97203Ozzie\r\nSmith\r\n1981\r\n4\r\n26.03562\r\n508\r\n0.550\r\n19\r\n12.02471Ozzie\r\nSmith\r\n1982\r\n5\r\n27.03562\r\n579\r\n0.653\r\n19\r\n11.93142Ozzie\r\nSmith\r\n1983\r\n6\r\n28.03562\r\n635\r\n0.656\r\n19\r\n12.37301Ozzie\r\nSmith\r\n1984\r\n7\r\n29.03562\r\n489\r\n0.684\r\n19\r\n11.75753Ozzie\r\nSmith\r\n1985\r\n8\r\n30.03836\r\n626\r\n0.716\r\n19\r\n13.14181Ozzie\r\nSmith\r\n1986\r\n9\r\n31.03836\r\n622\r\n0.709\r\n19\r\n13.40460Ozzie\r\nSmith\r\n1987\r\n10\r\n32.03836\r\n709\r\n0.775\r\n19\r\n15.87435Ozzie\r\nSmith\r\n1988\r\n11\r\n33.03836\r\n671\r\n0.686\r\n19\r\n15.32062Ozzie\r\nSmith\r\n1989\r\n12\r\n34.04110\r\n667\r\n0.696\r\n19\r\n15.36666Ozzie\r\nSmith\r\n1990\r\n13\r\n35.04110\r\n596\r\n0.635\r\n19\r\n15.70914Ozzie\r\nSmith\r\n1991\r\n14\r\n36.04110\r\n643\r\n0.747\r\n19\r\n18.33076Ozzie\r\nSmith\r\n1992\r\n15\r\n37.04110\r\n594\r\n0.709\r\n19\r\n17.10520Ozzie\r\nSmith\r\n1993\r\n16\r\n38.04384\r\n604\r\n0.693\r\n19\r\n17.98851Ozzie\r\nSmith\r\n1994\r\n17\r\n39.04384\r\n436\r\n0.675\r\n19\r\n18.13917Ozzie\r\nSmith\r\n1995\r\n18\r\n40.04384\r\n182\r\n0.526\r\n19\r\n18.45537Ozzie\r\nSmith\r\n1996\r\n19\r\n41.04384\r\n261\r\n0.728\r\n19\r\n19.86943\r\n\r\nYou can see the model is off by quite a bit for Ozzie Smith. The model predicts around 11 years until year number 8. From the average tenure by decade plot, we know the average tenure is around 9.5 years so the model was defaulting close to the average. I picked Ozzie not only because he is my favorite player, but because his value was derived from his defense and this model currently does not account for defensive production. Ozzie Smith won 13 gold gloves meaning he was the best at his position for 13 of the 19 years in the MLB. We would expect the model to be off for this type of player. In the future, we will obviously need to account for this.\r\nLet’s take a look at a great offensive player and see if the model does better. Unfortunately the greatest offensive player, Hank Aaron, isn’t in our dataset because he debuted before 1961, but the next best hitter in our dataset might be Tony Gwynn so let’s take a look at him.\r\n\r\n\r\nShow code\r\n\r\nxgb_theory %>% \r\n  predict(people_tenure) %>%\r\n  bind_cols(people_tenure) %>%\r\n  filter(playerID == 'gwynnto01') %>%\r\n  select(nameFirst, nameLast, yearID, year_num, age, TAB, OPS, tenure, .pred) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#bhykepcnrv .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#bhykepcnrv .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#bhykepcnrv .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#bhykepcnrv .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#bhykepcnrv .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#bhykepcnrv .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#bhykepcnrv .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#bhykepcnrv .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#bhykepcnrv .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#bhykepcnrv .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#bhykepcnrv .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#bhykepcnrv .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#bhykepcnrv .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#bhykepcnrv .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#bhykepcnrv .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#bhykepcnrv .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#bhykepcnrv .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#bhykepcnrv .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#bhykepcnrv .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#bhykepcnrv .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#bhykepcnrv .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#bhykepcnrv .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#bhykepcnrv .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#bhykepcnrv .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#bhykepcnrv .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#bhykepcnrv .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#bhykepcnrv .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#bhykepcnrv .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#bhykepcnrv .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#bhykepcnrv .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#bhykepcnrv .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#bhykepcnrv .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#bhykepcnrv .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#bhykepcnrv .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#bhykepcnrv .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nnameFirst\r\n      nameLast\r\n      yearID\r\n      year_num\r\n      age\r\n      TAB\r\n      OPS\r\n      tenure\r\n      .pred\r\n    Tony\r\nGwynn\r\n1982\r\n1\r\n21.66301\r\n209\r\n0.726\r\n20\r\n11.95321Tony\r\nGwynn\r\n1983\r\n2\r\n22.66301\r\n339\r\n0.727\r\n20\r\n11.77514Tony\r\nGwynn\r\n1984\r\n3\r\n23.66301\r\n688\r\n0.854\r\n20\r\n15.18588Tony\r\nGwynn\r\n1985\r\n4\r\n24.66575\r\n675\r\n0.772\r\n20\r\n13.59647Tony\r\nGwynn\r\n1986\r\n5\r\n25.66575\r\n712\r\n0.848\r\n20\r\n16.38655Tony\r\nGwynn\r\n1987\r\n6\r\n26.66575\r\n706\r\n0.958\r\n20\r\n16.89046Tony\r\nGwynn\r\n1988\r\n7\r\n27.66575\r\n591\r\n0.788\r\n20\r\n13.86852Tony\r\nGwynn\r\n1989\r\n8\r\n28.66849\r\n695\r\n0.813\r\n20\r\n16.08902Tony\r\nGwynn\r\n1990\r\n9\r\n29.66849\r\n649\r\n0.772\r\n20\r\n16.23166Tony\r\nGwynn\r\n1991\r\n10\r\n30.66849\r\n577\r\n0.787\r\n20\r\n15.32837Tony\r\nGwynn\r\n1992\r\n11\r\n31.66849\r\n581\r\n0.786\r\n20\r\n15.56111Tony\r\nGwynn\r\n1993\r\n12\r\n32.67123\r\n545\r\n0.895\r\n20\r\n17.28474Tony\r\nGwynn\r\n1994\r\n13\r\n33.67123\r\n491\r\n1.022\r\n20\r\n17.95643Tony\r\nGwynn\r\n1995\r\n14\r\n34.67123\r\n587\r\n0.888\r\n20\r\n18.29347Tony\r\nGwynn\r\n1996\r\n15\r\n35.67123\r\n510\r\n0.841\r\n20\r\n18.77420Tony\r\nGwynn\r\n1997\r\n16\r\n36.67397\r\n663\r\n0.956\r\n20\r\n19.80710Tony\r\nGwynn\r\n1998\r\n17\r\n37.67397\r\n511\r\n0.865\r\n20\r\n19.59279Tony\r\nGwynn\r\n1999\r\n18\r\n38.67397\r\n451\r\n0.858\r\n20\r\n19.84833Tony\r\nGwynn\r\n2000\r\n19\r\n39.67397\r\n142\r\n0.805\r\n20\r\n20.26111Tony\r\nGwynn\r\n2001\r\n20\r\n40.67671\r\n113\r\n0.845\r\n20\r\n21.19039\r\n\r\nIt’s good to see the model start off higher for Gwynn’s rookie year and even predicts 15 years of tenure for him in year number 3. The model then gets closer and closer to the right answer as the years pass.\r\nNow, let’s do the fun part and see how it predicts some MLB players early in their career. The three I am going to be looking at are young phenoms; Ronald Acuna, Fernando Tatis, & Juan Soto.\r\n\r\n\r\nShow code\r\n\r\nyoung_phenoms <- People %>%\r\n  select(playerID, nameFirst, nameLast, birthDate, debut, finalGame) %>%\r\n  filter(playerID %in% c('acunaro01', 'tatisfe02', 'sotoju01')) %>%\r\n  inner_join(Batting) %>%\r\n  group_by(playerID, yearID) %>%\r\n  summarise(nameFirst = first(nameFirst),\r\n            nameLast = first(nameLast),\r\n            birthDate = first(birthDate),\r\n            debut = first(debut),\r\n            finalGame = first(finalGame),\r\n            stint = first(stint),\r\n            teamID = first(teamID),\r\n            lgID = first(lgID),\r\n            G = sum(G),\r\n            AB = sum(AB),\r\n            R = sum(R),\r\n            H = sum(H),\r\n            X2B = sum(X2B),\r\n            X3B = sum(X3B),\r\n            HR = sum(HR),\r\n            RBI = sum(RBI),\r\n            SB = sum(SB),\r\n            CS = sum(CS),\r\n            BB = sum(BB),\r\n            SO = sum(SO),\r\n            IBB = sum(IBB),\r\n            HBP = sum(HBP),\r\n            SH = sum(SH),\r\n            SF = sum(SF),\r\n            GIDP = sum(GIDP),\r\n            .groups = \"drop\") %>%\r\n  Lahman::battingStats(data = .) %>%\r\n  group_by(playerID, stint) %>%\r\n  mutate(year_num = row_number()) %>%\r\n  ungroup() %>%\r\n  filter(yearID == 2019) %>%\r\n  group_by(playerID) %>%\r\n  mutate(tenure = n()) %>%\r\n  ungroup() %>%\r\n  mutate(age = as.double((ymd(paste0(yearID, '-01-01')) - ymd(birthDate))/365)) %>%\r\n  drop_na() %>%\r\n  mutate(decade = yearID %% 10) %>%\r\n  mutate(TBB = BB + IBB + HBP,         # combine all walk types\r\n         TAB = AB + TBB + SH + SF) %>% # create total at-bats\r\n  select(-c(BB, IBB, HBP, SH, SF))     # remove unneeded columns\r\n\r\nxgb_theory %>% \r\n  predict(young_phenoms) %>%\r\n  bind_cols(young_phenoms) %>%\r\n  select(nameFirst, nameLast, yearID, year_num, age, TAB, OPS, tenure, .pred) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#zbebisbkox .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#zbebisbkox .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#zbebisbkox .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#zbebisbkox .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#zbebisbkox .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#zbebisbkox .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#zbebisbkox .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#zbebisbkox .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#zbebisbkox .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#zbebisbkox .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#zbebisbkox .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#zbebisbkox .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#zbebisbkox .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#zbebisbkox .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#zbebisbkox .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#zbebisbkox .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#zbebisbkox .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#zbebisbkox .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#zbebisbkox .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#zbebisbkox .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#zbebisbkox .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#zbebisbkox .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#zbebisbkox .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#zbebisbkox .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#zbebisbkox .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#zbebisbkox .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#zbebisbkox .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#zbebisbkox .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#zbebisbkox .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#zbebisbkox .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#zbebisbkox .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#zbebisbkox .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#zbebisbkox .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#zbebisbkox .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#zbebisbkox .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nnameFirst\r\n      nameLast\r\n      yearID\r\n      year_num\r\n      age\r\n      TAB\r\n      OPS\r\n      tenure\r\n      .pred\r\n    Ronald\r\nAcuna\r\n2019\r\n2\r\n21.05205\r\n716\r\n0.883\r\n1\r\n17.25071Juan\r\nSoto\r\n2019\r\n2\r\n20.20000\r\n662\r\n0.949\r\n1\r\n16.44127Fernando\r\nTatis\r\n2019\r\n1\r\n20.01096\r\n373\r\n0.969\r\n1\r\n15.79035\r\n\r\nBased on 2019 data, the model expects Ronald Acuna to be in the league the longest but they all are very close to each other. Again, this is good to see. Most experts would predict these young players to be in the league for a very long time and 16 years is definitely a long time.\r\nNow let’s look at rookies from 2018, 2019 and 2020 and predict their tenure using 2020 data. 2020 was a short season due to the COVID-19 pandemic so we will have to extrapolate total at-bats from the 60 game season to a regular 162 game season.\r\n\r\n\r\nShow code\r\n\r\nrooks <- People %>%\r\n  select(playerID, nameFirst, nameLast, birthDate, debut, finalGame) %>%\r\n  filter( year(ymd(debut)) %in% c(2018, 2019, 2020)) %>%\r\n  inner_join(Batting) %>%\r\n  group_by(playerID, yearID) %>%\r\n  summarise(nameFirst = first(nameFirst),\r\n            nameLast = first(nameLast),\r\n            birthDate = first(birthDate),\r\n            debut = first(debut),\r\n            finalGame = first(finalGame),\r\n            stint = first(stint),\r\n            teamID = first(teamID),\r\n            lgID = first(lgID),\r\n            G = sum(G),\r\n            AB = sum(AB),\r\n            R = sum(R),\r\n            H = sum(H),\r\n            X2B = sum(X2B),\r\n            X3B = sum(X3B),\r\n            HR = sum(HR),\r\n            RBI = sum(RBI),\r\n            SB = sum(SB),\r\n            CS = sum(CS),\r\n            BB = sum(BB),\r\n            SO = sum(SO),\r\n            IBB = sum(IBB),\r\n            HBP = sum(HBP),\r\n            SH = sum(SH),\r\n            SF = sum(SF),\r\n            GIDP = sum(GIDP),\r\n            .groups = \"drop\") %>%\r\n  Lahman::battingStats(data = .) %>%\r\n  group_by(playerID, stint) %>%\r\n  mutate(year_num = row_number()) %>%\r\n  ungroup() %>%\r\n  group_by(playerID) %>%\r\n  filter(yearID == max(yearID)) %>%\r\n  ungroup() %>%\r\n  mutate(age = as.double((ymd(paste0(yearID, '-01-01')) - ymd(birthDate))/365)) %>%\r\n  drop_na() %>%\r\n  mutate(decade = yearID %% 10) %>%\r\n  mutate(TBB = BB + IBB + HBP,         # combine all walk types\r\n         TAB = AB + TBB + SH + SF) %>% # create total at-bats\r\n  select(-c(BB, IBB, HBP, SH, SF)) %>% # remove unneeded columns\r\n  mutate(TAB = (TAB/60)*162)\r\n\r\nxgb_theory %>% \r\n  predict(rooks) %>%\r\n  bind_cols(rooks) %>%\r\n  select(nameFirst, nameLast, year_num, age, TAB, OPS, .pred) %>%\r\n  arrange(desc(.pred)) %>%\r\n  head(10) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#tuqwyosqit .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#tuqwyosqit .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#tuqwyosqit .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#tuqwyosqit .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#tuqwyosqit .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#tuqwyosqit .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#tuqwyosqit .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#tuqwyosqit .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#tuqwyosqit .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#tuqwyosqit .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#tuqwyosqit .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#tuqwyosqit .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#tuqwyosqit .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#tuqwyosqit .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#tuqwyosqit .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#tuqwyosqit .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#tuqwyosqit .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#tuqwyosqit .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#tuqwyosqit .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#tuqwyosqit .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#tuqwyosqit .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#tuqwyosqit .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#tuqwyosqit .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#tuqwyosqit .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#tuqwyosqit .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#tuqwyosqit .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#tuqwyosqit .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#tuqwyosqit .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#tuqwyosqit .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#tuqwyosqit .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#tuqwyosqit .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#tuqwyosqit .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#tuqwyosqit .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#tuqwyosqit .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#tuqwyosqit .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nnameFirst\r\n      nameLast\r\n      year_num\r\n      age\r\n      TAB\r\n      OPS\r\n      .pred\r\n    Juan\r\nSoto\r\n3\r\n21.20000\r\n561.6\r\n1.185\r\n17.60920Fernando\r\nTatis\r\n2\r\n21.01096\r\n696.6\r\n0.937\r\n16.89737Luis\r\nGarcia\r\n1\r\n19.64110\r\n375.3\r\n0.668\r\n16.45621Ronald\r\nAcuna\r\n3\r\n22.05205\r\n550.8\r\n0.987\r\n15.95809Vladimir\r\nGuerrero\r\n2\r\n20.81096\r\n658.8\r\n0.791\r\n15.93926Kyle\r\nTucker\r\n3\r\n22.96986\r\n621.0\r\n0.837\r\n14.69650Eloy\r\nJimenez\r\n2\r\n23.10959\r\n610.2\r\n0.891\r\n13.75860Franmil\r\nReyes\r\n3\r\n24.50411\r\n650.7\r\n0.794\r\n13.58006Bo\r\nBichette\r\n2\r\n21.84110\r\n348.3\r\n0.840\r\n13.55870Trent\r\nGrisham\r\n2\r\n23.18082\r\n677.7\r\n0.808\r\n13.43157\r\n\r\nThis great to see and passes the eye-test extremely well. All of those young players are some of the best in the league and we would expect them to be on the top of the list if we were to predict tenure.\r\nNext Steps\r\nNow that we have a base model, we can start to improve it. The next steps are:\r\nAnalyze the times our model was the most wrong and see if there is a pattern\r\nBased on step one, we then introduce new features to correct large errors\r\nFinally, we need to tune the hyper-parameters for our model.\r\nAll those steps will be covered in the next blog post.\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-07-08-predicting-customer-tenurewith-mlb-hitters/corrplot.png",
    "last_modified": "2021-07-17T19:11:52-05:00",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  },
  {
    "path": "posts/2021-06-18-customer-segmentationwith-mlb-players/",
    "title": "Customer Segmentation...with MLB players Pt. 1",
    "description": "Many businesses try to create customer segmentation to gain a greater understanding of their customer base. This post will show how this can be done from start to finish and how to interpret and validate the newly found segments. Throughout this example advice on how to do this with retail data is given.",
    "author": [
      {
        "name": "Louis Oberdiear",
        "url": "thelob.blog/louisoberdiear"
      }
    ],
    "date": "2021-06-18",
    "categories": [
      "customer segmentation",
      "customer series",
      "cluster analysis",
      "data science",
      "rstats"
    ],
    "contents": "\r\n\r\nContents\r\nCustomer Segmentation of MLB Baseball Players\r\nThe Data\r\nEDA\r\nK-Means Cluster Analysis\r\nElbow Method\r\nSilhouette Method\r\nGap Statistic\r\nCluster 1 = The Three True Outcome Hitters\r\nCluster 2 = All Around Good Hitters\r\nCluster 3 = Weak Hitters\r\nCluster 4 = Balls-in-Play\r\n\r\n\r\nSummary\r\n\r\nCustomer Segmentation of MLB Baseball Players\r\nThe goal of customer segmentation is to find hidden groups in data. The customer in this example will be MLB hitters. We are going to be coming at this problem as if we don’t know anything about MLB hitters to understand the different types of hitters utilizing different clustering algorithms.\r\nThe Data\r\nFor customer segmentation, you need data that describes the customer. In retail, this could be how recently they have made a purchase, how many times they have purchased in the last 12 months, and the total amount of money they have spent in the last 12 months. These describe a customer’s shopping behavior. You could include age and some other area demographics like Zip Code Household Income and Household size. You just need relevant data that describes the customer.\r\nIn this example, we need to get data that describes MLB hitters. We are going to use data from 2018 for the following:\r\nTotal At Bats\r\nWalks\r\nStrikeouts\r\nSingles\r\nDoubles\r\nTriples\r\nHome Runs\r\nThe reason for these specific data points is because they are the outcomes of an at-bat. This could be applied to retail settings also. The number of times a person visits your site, time spent browsing the site, products looked at, the number of products added to the cart, and the number of products purchased.\r\nWe can find the data in the R package ‘Lahman’ which is from Sean Lahman’s baseball database. More info can be found here: www.seanlahman.com\r\nInstall the package:\r\n\r\n\r\nShow code\r\n\r\ninstall.packages(\"Lahman\")\r\n\r\n\r\n\r\n\r\n\r\nShow code\r\n\r\nlibrary(Lahman)\r\nlibrary(gt)\r\ndata(Batting)\r\nhead(Batting) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#hvkdmhsdrf .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#hvkdmhsdrf .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#hvkdmhsdrf .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#hvkdmhsdrf .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#hvkdmhsdrf .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#hvkdmhsdrf .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#hvkdmhsdrf .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#hvkdmhsdrf .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#hvkdmhsdrf .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#hvkdmhsdrf .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#hvkdmhsdrf .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#hvkdmhsdrf .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#hvkdmhsdrf .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#hvkdmhsdrf .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#hvkdmhsdrf .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#hvkdmhsdrf .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#hvkdmhsdrf .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#hvkdmhsdrf .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#hvkdmhsdrf .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#hvkdmhsdrf .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#hvkdmhsdrf .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#hvkdmhsdrf .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#hvkdmhsdrf .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#hvkdmhsdrf .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#hvkdmhsdrf .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#hvkdmhsdrf .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#hvkdmhsdrf .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#hvkdmhsdrf .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#hvkdmhsdrf .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#hvkdmhsdrf .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#hvkdmhsdrf .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#hvkdmhsdrf .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#hvkdmhsdrf .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#hvkdmhsdrf .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#hvkdmhsdrf .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nplayerID\r\n      yearID\r\n      stint\r\n      teamID\r\n      lgID\r\n      G\r\n      AB\r\n      R\r\n      H\r\n      X2B\r\n      X3B\r\n      HR\r\n      RBI\r\n      SB\r\n      CS\r\n      BB\r\n      SO\r\n      IBB\r\n      HBP\r\n      SH\r\n      SF\r\n      GIDP\r\n    abercda01\r\n1871\r\n1\r\nTRO\r\nNA\r\n1\r\n4\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\nNA\r\nNA\r\nNA\r\nNA\r\n0addybo01\r\n1871\r\n1\r\nRC1\r\nNA\r\n25\r\n118\r\n30\r\n32\r\n6\r\n0\r\n0\r\n13\r\n8\r\n1\r\n4\r\n0\r\nNA\r\nNA\r\nNA\r\nNA\r\n0allisar01\r\n1871\r\n1\r\nCL1\r\nNA\r\n29\r\n137\r\n28\r\n40\r\n4\r\n5\r\n0\r\n19\r\n3\r\n1\r\n2\r\n5\r\nNA\r\nNA\r\nNA\r\nNA\r\n1allisdo01\r\n1871\r\n1\r\nWS3\r\nNA\r\n27\r\n133\r\n28\r\n44\r\n10\r\n2\r\n2\r\n27\r\n1\r\n1\r\n0\r\n2\r\nNA\r\nNA\r\nNA\r\nNA\r\n0ansonca01\r\n1871\r\n1\r\nRC1\r\nNA\r\n25\r\n120\r\n29\r\n39\r\n11\r\n3\r\n0\r\n16\r\n6\r\n2\r\n2\r\n1\r\nNA\r\nNA\r\nNA\r\nNA\r\n0armstbo01\r\n1871\r\n1\r\nFW1\r\nNA\r\n12\r\n49\r\n9\r\n11\r\n2\r\n1\r\n0\r\n5\r\n0\r\n1\r\n0\r\n1\r\nNA\r\nNA\r\nNA\r\nNA\r\n0\r\n\r\nGlimpse the data:\r\n\r\n\r\nShow code\r\n\r\nlibrary(dplyr)\r\nglimpse(Batting)\r\n\r\n\r\nRows: 108,789\r\nColumns: 22\r\n$ playerID <chr> \"abercda01\", \"addybo01\", \"allisar01\", \"allisdo01\", ~\r\n$ yearID   <int> 1871, 1871, 1871, 1871, 1871, 1871, 1871, 1871, 187~\r\n$ stint    <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ~\r\n$ teamID   <fct> TRO, RC1, CL1, WS3, RC1, FW1, RC1, BS1, FW1, BS1, C~\r\n$ lgID     <fct> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ G        <int> 1, 25, 29, 27, 25, 12, 1, 31, 1, 18, 22, 1, 10, 3, ~\r\n$ AB       <int> 4, 118, 137, 133, 120, 49, 4, 157, 5, 86, 89, 3, 36~\r\n$ R        <int> 0, 30, 28, 28, 29, 9, 0, 66, 1, 13, 18, 0, 6, 7, 24~\r\n$ H        <int> 0, 32, 40, 44, 39, 11, 1, 63, 1, 13, 27, 0, 7, 6, 3~\r\n$ X2B      <int> 0, 6, 4, 10, 11, 2, 0, 10, 1, 2, 1, 0, 0, 0, 9, 3, ~\r\n$ X3B      <int> 0, 0, 5, 2, 3, 1, 0, 9, 0, 1, 10, 0, 0, 0, 1, 3, 0,~\r\n$ HR       <int> 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 1, 0, 0, ~\r\n$ RBI      <int> 0, 13, 19, 27, 16, 5, 2, 34, 1, 11, 18, 0, 1, 5, 21~\r\n$ SB       <int> 0, 8, 3, 1, 6, 0, 0, 11, 0, 1, 0, 0, 2, 2, 4, 4, 0,~\r\n$ CS       <int> 0, 1, 1, 1, 2, 1, 0, 6, 0, 0, 1, 0, 0, 0, 0, 4, 0, ~\r\n$ BB       <int> 0, 4, 2, 0, 2, 0, 1, 13, 0, 0, 3, 1, 2, 0, 2, 9, 0,~\r\n$ SO       <int> 0, 0, 5, 2, 1, 1, 0, 1, 0, 0, 4, 0, 0, 0, 2, 2, 3, ~\r\n$ IBB      <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ HBP      <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ SH       <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ SF       <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~\r\n$ GIDP     <int> 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 2, 0, 1, 2, 0, ~\r\n\r\nWe only want data from 2018 so we need to filter down and select the data points we want:\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 <- Batting %>%\r\n  filter(yearID == 2018) %>%\r\n  select(c(playerID, teamID, lgID, G, AB, SH, SF, BB, HBP, IBB, SO, H, X2B, X3B, HR))\r\nhead(batting_2018) %>% gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#aqyhxtzgth .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#aqyhxtzgth .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#aqyhxtzgth .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#aqyhxtzgth .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#aqyhxtzgth .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#aqyhxtzgth .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#aqyhxtzgth .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#aqyhxtzgth .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#aqyhxtzgth .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#aqyhxtzgth .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#aqyhxtzgth .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#aqyhxtzgth .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#aqyhxtzgth .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#aqyhxtzgth .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#aqyhxtzgth .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#aqyhxtzgth .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#aqyhxtzgth .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#aqyhxtzgth .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#aqyhxtzgth .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#aqyhxtzgth .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#aqyhxtzgth .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#aqyhxtzgth .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#aqyhxtzgth .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#aqyhxtzgth .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#aqyhxtzgth .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#aqyhxtzgth .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#aqyhxtzgth .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#aqyhxtzgth .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#aqyhxtzgth .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#aqyhxtzgth .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#aqyhxtzgth .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#aqyhxtzgth .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#aqyhxtzgth .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#aqyhxtzgth .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#aqyhxtzgth .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nplayerID\r\n      teamID\r\n      lgID\r\n      G\r\n      AB\r\n      SH\r\n      SF\r\n      BB\r\n      HBP\r\n      IBB\r\n      SO\r\n      H\r\n      X2B\r\n      X3B\r\n      HR\r\n    abreujo02\r\nCHA\r\nAL\r\n128\r\n499\r\n0\r\n6\r\n37\r\n11\r\n7\r\n109\r\n132\r\n36\r\n1\r\n22acunaro01\r\nATL\r\nNL\r\n111\r\n433\r\n0\r\n3\r\n45\r\n6\r\n2\r\n123\r\n127\r\n26\r\n4\r\n26adamewi01\r\nTBA\r\nAL\r\n85\r\n288\r\n1\r\n2\r\n31\r\n1\r\n3\r\n95\r\n80\r\n7\r\n0\r\n10adamja01\r\nKCA\r\nAL\r\n31\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0adamsau02\r\nWAS\r\nNL\r\n2\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0adamsch01\r\nNYA\r\nAL\r\n3\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n\r\nFor the non-baseball people:\r\nAB = At Bats\r\nSH = Sacrifice Bunt\r\nSF = Sacrifice Fly\r\nBB = Base on Balls (walks)\r\nHBP = Hit By Pitch\r\nIBB = Intentional Base on Balls (intentional walks)\r\nSO = Strike Outs\r\nH = Singles\r\nX2H = Doubles\r\nX3H = Triples\r\nHR = Home Runs\r\nThe reason we are pulling extra data points like SH, SF, HBP, & IBB is that in the end, we want Total At Bats. Baseball data is a little tricky in that only some plate appearances are considered an ‘At Bat’. Walks and sacrifices aren’t considered an ‘At Bat’ but for this analysis, we’ll want the total number of times they come to the plate in a season.\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 <- batting_2018 %>%\r\n  mutate(TBB = BB + IBB + HBP,         # combine all walk types\r\n         TAB = AB + TBB + SH + SF) %>% # create total at-bats\r\n  select(-c(BB, IBB, HBP, SH, SF)) %>% # remove unneeded columns\r\n  select(c(playerID, teamID, lgID, G, TAB, TBB, SO, H, X2B, X3B, HR))\r\n\r\nhead(batting_2018) %>% gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#fysqkvslbd .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#fysqkvslbd .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fysqkvslbd .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#fysqkvslbd .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#fysqkvslbd .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#fysqkvslbd .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fysqkvslbd .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#fysqkvslbd .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#fysqkvslbd .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#fysqkvslbd .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#fysqkvslbd .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#fysqkvslbd .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#fysqkvslbd .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#fysqkvslbd .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#fysqkvslbd .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#fysqkvslbd .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#fysqkvslbd .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#fysqkvslbd .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#fysqkvslbd .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#fysqkvslbd .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#fysqkvslbd .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#fysqkvslbd .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#fysqkvslbd .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#fysqkvslbd .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fysqkvslbd .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#fysqkvslbd .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fysqkvslbd .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#fysqkvslbd .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#fysqkvslbd .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#fysqkvslbd .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#fysqkvslbd .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#fysqkvslbd .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#fysqkvslbd .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#fysqkvslbd .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#fysqkvslbd .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nplayerID\r\n      teamID\r\n      lgID\r\n      G\r\n      TAB\r\n      TBB\r\n      SO\r\n      H\r\n      X2B\r\n      X3B\r\n      HR\r\n    abreujo02\r\nCHA\r\nAL\r\n128\r\n560\r\n55\r\n109\r\n132\r\n36\r\n1\r\n22acunaro01\r\nATL\r\nNL\r\n111\r\n489\r\n53\r\n123\r\n127\r\n26\r\n4\r\n26adamewi01\r\nTBA\r\nAL\r\n85\r\n326\r\n35\r\n95\r\n80\r\n7\r\n0\r\n10adamja01\r\nKCA\r\nAL\r\n31\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0adamsau02\r\nWAS\r\nNL\r\n2\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0adamsch01\r\nNYA\r\nAL\r\n3\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n0\r\n\r\nEDA\r\nLet’s do some EDA on our data:\r\n\r\n\r\nShow code\r\n\r\nlibrary(DataExplorer)\r\nDataExplorer::profile_missing(batting_2018) %>%\r\n  arrange(desc(num_missing)) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#ztbkocjqee .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#ztbkocjqee .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#ztbkocjqee .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#ztbkocjqee .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#ztbkocjqee .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#ztbkocjqee .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#ztbkocjqee .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#ztbkocjqee .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#ztbkocjqee .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#ztbkocjqee .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#ztbkocjqee .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#ztbkocjqee .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#ztbkocjqee .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#ztbkocjqee .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#ztbkocjqee .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#ztbkocjqee .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#ztbkocjqee .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#ztbkocjqee .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#ztbkocjqee .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#ztbkocjqee .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#ztbkocjqee .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#ztbkocjqee .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#ztbkocjqee .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#ztbkocjqee .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#ztbkocjqee .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#ztbkocjqee .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#ztbkocjqee .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#ztbkocjqee .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#ztbkocjqee .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#ztbkocjqee .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#ztbkocjqee .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#ztbkocjqee .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#ztbkocjqee .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#ztbkocjqee .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#ztbkocjqee .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nfeature\r\n      num_missing\r\n      pct_missing\r\n    playerID\r\n0\r\n0teamID\r\n0\r\n0lgID\r\n0\r\n0G\r\n0\r\n0TAB\r\n0\r\n0TBB\r\n0\r\n0SO\r\n0\r\n0H\r\n0\r\n0X2B\r\n0\r\n0X3B\r\n0\r\n0HR\r\n0\r\n0\r\n\r\nNo missing data. Let’s look at the distributions:\r\n\r\n\r\nShow code\r\n\r\nDataExplorer::plot_bar(batting_2018, ncol = 4, nrow = 4)\r\n\r\n\r\n\r\nShow code\r\n\r\nDataExplorer::plot_histogram(batting_2018, ncol = 4, nrow = 4)\r\n\r\n\r\n\r\n\r\nA LOT of zero values. We need to figure out a good minimum for the number of games played a hitter needs to be included in our analysis. For this, instead of using analysis, I’m going to use business logic and require a player to have at least appeared in 100 games in the 2018 season.\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 <- batting_2018 %>%\r\n  filter(G >= 100)\r\n\r\n\r\n\r\nLook at the distributions again:\r\n\r\n\r\nShow code\r\n\r\nDataExplorer::plot_histogram(batting_2018, ncol = 4, nrow = 4)\r\n\r\n\r\n\r\n\r\nMuch better. Most distributions (other than triples) are looking a lot more normal. Triples happen so infrequently that I’m going to combine them with doubles and call them extra-base hits.\r\nIn cluster analysis, it’s important to get all data points on the same scale. If you run the unscaled data through the kmeans algorithm it will potentially over-emphasize a variable that is on a larger scale. In retail this is common. If you have the number of times visited the store and dollars per visit then the kmeans algorithm will over-emphasize dollars per visit because it could potentially be in the hundreds or thousands of dollars while visits are only in the single and double-digit range.\r\nIn this example, we have to take an extra step before we scale. We want to make everything a per-at-bat level. This will let us know the percentage of times a player walks, gets a hit, etc then we will scale each variable. This could also be done for retail data and transforming the data at a per-visit level.\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 <- batting_2018 %>%\r\n  mutate(XBH = X2B + X3B,\r\n         walks = TBB/TAB,\r\n         strikeouts = SO/TAB,\r\n         singles = H/TAB,\r\n         extras = XBH/TAB,\r\n         triples = X3B/TAB,\r\n         homeruns = HR/TAB) %>%\r\n  mutate(walks_scaled = scale(walks),\r\n         strikeouts_scaled = scale(strikeouts),\r\n         singles_scaled = scale(singles),\r\n         extras_scaled = scale(extras),\r\n         homeruns_scaled = scale(homeruns))\r\n\r\nhead(batting_2018) %>% gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#runtdccatv .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#runtdccatv .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#runtdccatv .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#runtdccatv .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#runtdccatv .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#runtdccatv .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#runtdccatv .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#runtdccatv .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#runtdccatv .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#runtdccatv .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#runtdccatv .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#runtdccatv .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#runtdccatv .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#runtdccatv .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#runtdccatv .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#runtdccatv .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#runtdccatv .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#runtdccatv .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#runtdccatv .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#runtdccatv .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#runtdccatv .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#runtdccatv .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#runtdccatv .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#runtdccatv .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#runtdccatv .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#runtdccatv .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#runtdccatv .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#runtdccatv .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#runtdccatv .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#runtdccatv .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#runtdccatv .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#runtdccatv .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#runtdccatv .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#runtdccatv .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#runtdccatv .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\nplayerID\r\n      teamID\r\n      lgID\r\n      G\r\n      TAB\r\n      TBB\r\n      SO\r\n      H\r\n      X2B\r\n      X3B\r\n      HR\r\n      XBH\r\n      walks\r\n      strikeouts\r\n      singles\r\n      extras\r\n      triples\r\n      homeruns\r\n      walks_scaled\r\n      strikeouts_scaled\r\n      singles_scaled\r\n      extras_scaled\r\n      homeruns_scaled\r\n    abreujo02\r\nCHA\r\nAL\r\n128\r\n560\r\n55\r\n109\r\n132\r\n36\r\n1\r\n22\r\n37\r\n0.09821429\r\n0.1946429\r\n0.2357143\r\n0.06607143\r\n0.001785714\r\n0.03928571\r\n-0.1574981\r\n-0.2393866\r\n0.30032062\r\n1.1686432\r\n0.4940999acunaro01\r\nATL\r\nNL\r\n111\r\n489\r\n53\r\n123\r\n127\r\n26\r\n4\r\n26\r\n30\r\n0.10838446\r\n0.2515337\r\n0.2597137\r\n0.06134969\r\n0.008179959\r\n0.05316973\r\n0.1310304\r\n0.7245586\r\n1.20778753\r\n0.7962888\r\n1.4262794adriaeh01\r\nMIN\r\nAL\r\n114\r\n368\r\n27\r\n82\r\n84\r\n23\r\n1\r\n6\r\n24\r\n0.07336957\r\n0.2228261\r\n0.2282609\r\n0.06521739\r\n0.002717391\r\n0.01630435\r\n-0.8623447\r\n0.2381431\r\n0.01849173\r\n1.1012941\r\n-1.0488797aguilje01\r\nMIL\r\nNL\r\n149\r\n569\r\n67\r\n143\r\n135\r\n25\r\n0\r\n35\r\n25\r\n0.11775044\r\n0.2513181\r\n0.2372583\r\n0.04393673\r\n0.000000000\r\n0.06151142\r\n0.3967440\r\n0.7209049\r\n0.35870476\r\n-0.5768913\r\n1.9863443ahmedni01\r\nARI\r\nNL\r\n153\r\n566\r\n44\r\n109\r\n121\r\n33\r\n5\r\n16\r\n38\r\n0.07773852\r\n0.1925795\r\n0.2137809\r\n0.06713781\r\n0.008833922\r\n0.02826855\r\n-0.7383973\r\n-0.2743475\r\n-0.52902478\r\n1.2527376\r\n-0.2455976albieoz01\r\nATL\r\nNL\r\n158\r\n684\r\n41\r\n116\r\n167\r\n40\r\n5\r\n24\r\n45\r\n0.05994152\r\n0.1695906\r\n0.2441520\r\n0.06578947\r\n0.007309942\r\n0.03508772\r\n-1.2432994\r\n-0.6638652\r\n0.61936959\r\n1.1464083\r\n0.2122445\r\n\r\nK-Means Cluster Analysis\r\nWe have the data prepped and scaled so we are ready to run it through the kmeans algorithm. The tricky part of cluster analysis via kmeans is kmeans forces the user to select the number of clusters (k). Our first task is determining k and there are a few ways to do this. The three methods I will showcase is called the elbow method, silhouette scores, and gap statistic.\r\nElbow Method\r\n\r\n\r\nShow code\r\n\r\nlibrary(factoextra)\r\nfviz_nbclust(select(batting_2018, contains('scaled')), kmeans, method = \"wss\")\r\n\r\n\r\n\r\n\r\nThe elbow method plots the total within sum of square errors. The way kmeans works guarantees that the tot.withinss will always decrease with an increase in clusters. Our goal isn’t to find the lowest tot.withinss but to find the point of diminishing returns or the ‘elbow’ point in the graph. The elbow seems to be at 4 clusters.\r\nSilhouette Method\r\n\r\n\r\nShow code\r\n\r\nfviz_nbclust(select(batting_2018, contains('scaled')), kmeans, method = \"silhouette\")\r\n\r\n\r\n\r\n\r\nThis method suggests 2 with 3 being close behind.\r\nGap Statistic\r\n\r\n\r\nShow code\r\n\r\nfviz_nbclust(select(batting_2018, contains('scaled')), kmeans, method = \"gap_stat\")\r\n\r\n\r\n\r\n\r\nThe gap statistic suggests 1 cluster. Unfortunately the methods don’t all agree which is usually the case when doing this analysis out in the wild. Fortunately we can visualize the clusters. We are going to only visualize 3 and 4 clusters because 2 clusters wouldn’t be informative enough to give us any insights.\r\n\r\n\r\nShow code\r\n\r\nset.seed(123)\r\nk3 <- kmeans(select(batting_2018, contains('scaled')), 3, nstart = 25)\r\nk4 <- kmeans(select(batting_2018, contains('scaled')), 4, nstart = 25)\r\nfviz_cluster(k3, data = select(batting_2018, contains('scaled')))\r\n\r\n\r\n\r\nShow code\r\n\r\nfviz_cluster(k4, data = select(batting_2018, contains('scaled')))\r\n\r\n\r\n\r\n\r\nNot great separation so it’s understandable that none of the methods agreed on a specific k but I like 4 clusters so we are going to go with that. Let’s join the clusters back to the data and see if we can determine the types of hitters in each cluster. Remember since we scaled the data we are looking at standard scores or z-scores. A z-score of 0 means average for that stat, the more positive means the more above average and vice-versa for negative scores.\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  group_by(cluster) %>%\r\n  summarize(n = n(),\r\n         walks = mean(walks_scaled),\r\n         strikeouts = mean(strikeouts_scaled),\r\n         singles = mean(singles_scaled),\r\n         extras = mean(extras_scaled),\r\n         homeruns = mean(homeruns_scaled)) %>%\r\n  gt()\r\n\r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#xtogdahtyp .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#xtogdahtyp .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#xtogdahtyp .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#xtogdahtyp .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#xtogdahtyp .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#xtogdahtyp .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#xtogdahtyp .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#xtogdahtyp .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#xtogdahtyp .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#xtogdahtyp .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#xtogdahtyp .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#xtogdahtyp .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#xtogdahtyp .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#xtogdahtyp .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#xtogdahtyp .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#xtogdahtyp .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#xtogdahtyp .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#xtogdahtyp .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#xtogdahtyp .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#xtogdahtyp .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#xtogdahtyp .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#xtogdahtyp .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#xtogdahtyp .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#xtogdahtyp .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#xtogdahtyp .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#xtogdahtyp .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#xtogdahtyp .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#xtogdahtyp .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#xtogdahtyp .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#xtogdahtyp .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#xtogdahtyp .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#xtogdahtyp .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#xtogdahtyp .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#xtogdahtyp .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#xtogdahtyp .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-weight: normal;\r\n  font-size: 65%;\r\n}\r\ncluster\r\n      n\r\n      walks\r\n      strikeouts\r\n      singles\r\n      extras\r\n      homeruns\r\n    1\r\n39\r\n1.4976302\r\n0.4546602\r\n-0.6094075\r\n-0.55614687\r\n0.941893212\r\n53\r\n-0.2066408\r\n-0.1284540\r\n0.7968028\r\n1.09735051\r\n0.615763323\r\n75\r\n-0.1431369\r\n0.6372036\r\n-0.7537442\r\n-0.49739296\r\n-0.096224734\r\n70\r\n-0.5245764\r\n-0.8387708\r\n0.5438166\r\n0.01192319\r\n-0.88789195\r\n\r\nLet’s visualize these clusters with some bar charts. Might be easier to digest.\r\n\r\n\r\nShow code\r\n\r\nlibrary(tidyr)\r\nlibrary(ggplot2)\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  group_by(cluster) %>%\r\n  summarize(walks = mean(walks_scaled),\r\n         strikeouts = mean(strikeouts_scaled),\r\n         singles = mean(singles_scaled),\r\n         extras = mean(extras_scaled),\r\n         homeruns = mean(homeruns_scaled),\r\n         .groups = 'drop') %>%\r\n  pivot_longer(!cluster, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  facet_wrap(facets = vars(cluster), nrow = 2, ncol = 2)\r\n\r\n\r\n\r\n\r\nCluster 1 = high walks, high strikeouts, low singles, low extras, high homeruns\r\nCluster 2 = low walks, low strikeouts, high singles, high extras, high homeruns\r\nCluster 3 = low walks, highish strikouts, low singles, low extras, low homeruns\r\nCluster 4 = low walks, low strikeouts, high singles, avg extras, low homeruns\r\nLet’s give them names.\r\nCluster 1 = The Three True Outcome Hitters\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  group_by(cluster) %>%\r\n  summarize(walks = mean(walks_scaled),\r\n         strikeouts = mean(strikeouts_scaled),\r\n         singles = mean(singles_scaled),\r\n         extras = mean(extras_scaled),\r\n         homeruns = mean(homeruns_scaled),\r\n         .groups = 'drop') %>%\r\n  pivot_longer(!cluster, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  filter(cluster == 1) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  ggtitle(label = \"The Three True Outcome Hitters\")\r\n\r\n\r\n\r\n\r\nThese hitters are already known in the baseball world and have been give a name because every at bat results in one of the ‘Three True Outcomes’ which are Walk, Strikeout, Home Run. Examples of this type of hitter is Aaron Judge and Bryce Harper. Let’s see if they ended up in cluster 1.\r\n\r\n\r\nShow code\r\n\r\n#Aaron Judge, Bryce Harper\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  filter(playerID %in% c(\"judgeaa01\",\"harpebr03\")) %>%\r\n  select(playerID, contains('scaled')) %>%\r\n  pivot_longer(!playerID, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  facet_wrap(facets = vars(playerID), nrow = 2, ncol = 2) +\r\n  ggtitle(label = \"Bryce Harper and Aaron Judge\")\r\n\r\n\r\n\r\n\r\nLet’s check the other hitters in this cluster:\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  filter(cluster == 1) %>%\r\n  arrange(desc(G)) %>%\r\n  select(playerID, teamID, cluster, contains('scaled')) %>%\r\n  head() %>%\r\n  select(playerID, contains('scaled')) %>%\r\n  pivot_longer(!playerID, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  facet_wrap(facets = vars(playerID), nrow = 2, ncol = 3) +\r\n  ggtitle(label = \"The Three True Outcome Hitters\")\r\n\r\n\r\n\r\n\r\nAll of these are pretty good examples of ‘Three True Outcome’ hitters except Carlos Santana (santaca01). His defining attribute is that he draws a ton of walks, but he doesn’t strikeout or hit above average home runs so he is not a great fit for this category. The most likely reason he was put in here is because he fits the walk profile of this group and doesn’t belong in any of the other groups either.\r\nCluster 2 = All Around Good Hitters\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  group_by(cluster) %>%\r\n  summarize(walks = mean(walks_scaled),\r\n         strikeouts = mean(strikeouts_scaled),\r\n         singles = mean(singles_scaled),\r\n         extras = mean(extras_scaled),\r\n         homeruns = mean(homeruns_scaled),\r\n         .groups = 'drop') %>%\r\n  pivot_longer(!cluster, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  filter(cluster == 2) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  ggtitle(label = \"All Around Good Hitters\")\r\n\r\n\r\n\r\n\r\nThey don’t have a weak area, walk enough, hit a lot of singles and have power by hitting a lot of homeruns. These are the well-rounded great hitters. We would expect the MVP winner Mookie Betts to be in this category. He might well be the most well-rounded hitter in the MLB with almost no weaknesses.\r\n\r\n\r\nShow code\r\n\r\n#Mookie Betts\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  filter(playerID %in% c(\"bettsmo01\")) %>%\r\n  select(playerID, teamID, cluster, contains('scaled')) %>%\r\n  select(playerID, contains('scaled')) %>%\r\n  pivot_longer(!playerID, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  ggtitle(label = \"Mookie Betts\")\r\n\r\n\r\n\r\n\r\nLook at those z-scores for Mookie. Incredible.\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  filter(cluster == 2) %>%\r\n  arrange(desc(G)) %>%\r\n  select(playerID, teamID, cluster, contains('scaled')) %>%\r\n  head() %>%\r\n  select(playerID, contains('scaled')) %>%\r\n  pivot_longer(!playerID, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  facet_wrap(facets = vars(playerID), nrow = 2, ncol = 3) +\r\n  ggtitle(label = \"All Around Good Hitters\")\r\n\r\n\r\n\r\n\r\nAll of the hitters shown above are great hitters. This is good to see.\r\nCluster 3 = Weak Hitters\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  group_by(cluster) %>%\r\n  summarize(walks = mean(walks_scaled),\r\n         strikeouts = mean(strikeouts_scaled),\r\n         singles = mean(singles_scaled),\r\n         extras = mean(extras_scaled),\r\n         homeruns = mean(homeruns_scaled),\r\n         .groups = 'drop') %>%\r\n  pivot_longer(!cluster, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  filter(cluster == 3) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  ggtitle(label = \"Weak Hitters\")\r\n\r\n\r\n\r\n\r\nThese batters struggle getting on base (Walks) and strikeout a lot. These are the weak hitters that are most likely at the bottom of the batting order. Most of these names would not be familiar to casual MLB fans.\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  filter(cluster == 3) %>%\r\n  arrange(desc(G)) %>%\r\n  select(playerID, teamID, cluster, contains('scaled')) %>%\r\n  head() %>%\r\n  select(playerID, contains('scaled')) %>%\r\n  pivot_longer(!playerID, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  facet_wrap(facets = vars(playerID), nrow = 2, ncol = 3) +\r\n  ggtitle(label = \"Weak Hitters\")\r\n\r\n\r\n\r\n\r\nCluster 4 = Balls-in-Play\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  group_by(cluster) %>%\r\n  summarize(walks = mean(walks_scaled),\r\n         strikeouts = mean(strikeouts_scaled),\r\n         singles = mean(singles_scaled),\r\n         extras = mean(extras_scaled),\r\n         homeruns = mean(homeruns_scaled),\r\n         .groups = 'drop') %>%\r\n  pivot_longer(!cluster, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  filter(cluster == 4) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  ggtitle(label = \"Balls-in-Play\")\r\n\r\n\r\n\r\n\r\nThey don’t walk, they don’t strikeout, and they don’t hit home runs. They just put the ball in play in most at bats.\r\n\r\n\r\nShow code\r\n\r\nbatting_2018 %>%\r\n  mutate(cluster = k4$cluster) %>%\r\n  filter(cluster == 4) %>%\r\n  arrange(desc(G)) %>%\r\n  select(playerID, teamID, cluster, contains('scaled')) %>%\r\n  head() %>%\r\n  select(playerID, contains('scaled')) %>%\r\n  pivot_longer(!playerID, names_to = \"hitting_category\", values_to = \"z_score\") %>%\r\n  mutate(pos = z_score >= 0) %>%\r\n  ggplot(aes(x = hitting_category, y = z_score, fill = pos)) +\r\n  geom_bar(stat = \"identity\") +\r\n  coord_flip() +\r\n  theme(legend.position = \"none\") +\r\n  facet_wrap(facets = vars(playerID), nrow = 2, ncol = 3) +\r\n  ggtitle(label = \"Balls-in-Play\")\r\n\r\n\r\n\r\n\r\nNick Markakis is a great example of these cluster. He walks slightly above average, almost never strikes out, a ton of singles and extras with well below average home runs.\r\nSummary\r\nWe went through the process of getting the customer data (MLB hitting data), exploring the missing values and distributions, scaling the data, determining an appropriate k using three different methods and then interpreting and validating our segments. The next step is to start using our new-found segments to gain insights on things like roster construction and position importance.\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-06-18-customer-segmentationwith-mlb-players/clusters.png",
    "last_modified": "2021-07-08T10:57:48-05:00",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  },
  {
    "path": "posts/welcome/",
    "title": "Welcome to The Lob",
    "description": "Welcome to my new blog, The Lob. I plan on using this blog to to explain and practice various data science techniques using sports data.",
    "author": [
      {
        "name": "Louis Oberdiear",
        "url": "thelob.blog/louisoberdiear"
      }
    ],
    "date": "2021-06-07",
    "categories": [],
    "contents": "\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2021-06-23T19:03:54-05:00",
    "input_file": {}
  }
]
